# çŸ¿çŸ³ç³»ç»Ÿå®ç°çŠ¶æ€

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. ç¢çŸ³æ¨¡å‹ä¼˜åŒ–
- âœ… çŸ³å¤´ç²¾çµå›¾ç®€åŒ–ä¸ºåªä¿ç•™ä¸‹åŠéƒ¨åˆ†ï¼ˆä¸¤å—å¤§çŸ³å¤´+ä¸€å—å°ç¢çŸ³ï¼‰
- âœ… æ›´ç®€æ´ç¾è§‚çš„è§†è§‰æ•ˆæœ

### 2. çŸ¿çŸ³ç²¾çµå›¾ç”Ÿæˆ
- âœ… 7ç§çŸ¿çŸ³ç±»å‹ï¼šé“œã€é”¡ã€é“ã€é“¶ã€é‡‘ã€é»‘é‡‘ã€é’»çŸ³
- âœ… åŸºäºç¢çŸ³æ¨¡å‹æ·»åŠ å½©è‰²çŸ¿ç‚¹
- âœ… çŸ¿çŸ³é¢œè‰²é…ç½®ï¼š
  - é“œçŸ¿ `#d97706` (æ©™æ£•è‰²)
  - é”¡çŸ¿ `#94a3b8` (ç°è“è‰²)
  - é“çŸ¿ `#78716c` (æ£•ç°è‰²)
  - é“¶çŸ¿ `#e5e7eb` (æµ…ç°è‰²)
  - é‡‘çŸ¿ `#fbbf24` (é»„è‰²)
  - é»‘é‡‘çŸ¿ `#a16207` (æ·±é‡‘è‰²)
  - é’»çŸ³ `#06b6d4` (é’è‰²)

### 3. çŸ¿çŸ³ä¸–ç•Œç”Ÿæˆ
- âœ… çŸ¿çŸ³ç”Ÿæˆæ¦‚ç‡ï¼š15% of tree probability (æ¯”å²©çŸ³æ›´ç¨€æœ‰)
- âœ… ç¨€æœ‰åº¦åˆ†é…ï¼š
  - é“œçŸ¿ 30% (å¸¸è§)
  - é”¡çŸ¿ 25% (å¸¸è§)
  - é“çŸ¿ 20% (ä¸å¸¸è§)
  - é“¶çŸ¿ 13% (ç¨€æœ‰)
  - é‡‘çŸ¿ 8% (ç¨€æœ‰)
  - é»‘é‡‘çŸ¿ 3% (éå¸¸ç¨€æœ‰)
  - é’»çŸ³ 1% (ä¼ è¯´)
- âœ… çŸ¿çŸ³é¿å¼€æ ‘æœ¨ã€å²©çŸ³ã€å…¶ä»–çŸ¿çŸ³ï¼ˆ2Ã—cellé—´è·ï¼‰

### 4. é•å­åˆ¶ä½œç³»ç»Ÿ
- âœ… é•å­é…æ–¹ï¼š3çŸ³å— + 2æœ¨æ£ â†’ 1é•å­
- âœ… åœ¨å·¥ä½œå°åˆæˆç³»ç»Ÿä¸­æ·»åŠ 
- âœ… å¼€å±€èƒŒåŒ…ç»™16ä¸ªé•å­

### 5. çŸ¿çŸ³é‡‡é›†ç³»ç»Ÿ
- âœ… éœ€è¦è£…å¤‡é•å­æ‰èƒ½æŒ–æ˜çŸ¿çŸ³
- âœ… ç‚¹å‡»çŸ¿çŸ³æ—¶æ£€æµ‹é•å­è£…å¤‡çŠ¶æ€
- âœ… æœªè£…å¤‡é•å­æ—¶æ˜¾ç¤ºæç¤ºï¼š"éœ€è¦è£…å¤‡é•å­æ‰èƒ½æŒ–æ˜çŸ¿çŸ³"
- âœ… æŒ–æ˜æ—¶é—´ï¼š6ç§’
- âœ… è‡ªåŠ¨å¯»è·¯åˆ°çŸ¿çŸ³ä½ç½®
- âœ… æŒ–æ˜å®Œæˆåæ‰è½1-2ä¸ªå¯¹åº”çŸ¿çŸ³

### 6. åº“å­˜ç³»ç»Ÿå®Œå–„
- âœ… æ·»åŠ æ‰€æœ‰çŸ¿çŸ³ç±»å‹åˆ°inventory
- âœ… æ·»åŠ pickaxeåˆ°inventory  
- âœ… invCountæ”¯æŒæ‰€æœ‰æ–°ç‰©å“
- âœ… invDecæ”¯æŒæ‰€æœ‰æ–°ç‰©å“
- âœ… clearInventoryæ¸…ç†æ‰€æœ‰æ–°ç‰©å“
- âœ… resetInventoryToStarteråˆå§‹åŒ–æ‰€æœ‰ç‰©å“ä¸º16

### 7. æ‹¾å–ç³»ç»Ÿ
- âœ… æ‰€æœ‰çŸ¿çŸ³ç±»å‹çš„æ‹¾å–é€»è¾‘
- âœ… ä¸­æ–‡æµ®åŠ¨æ–‡å­—ï¼šé“œçŸ¿ã€é”¡çŸ¿ã€é“çŸ¿ã€é“¶çŸ¿ã€é‡‘çŸ¿ã€é»‘é‡‘çŸ¿ã€é’»çŸ³
- âœ… å¯¹åº”é¢œè‰²çš„æ‹¾å–æç¤º

### 8. äº¤äº’å–æ¶ˆ
- âœ… cancelTreeInteractionåŒ…å«çŸ¿çŸ³æŒ–æ˜å–æ¶ˆ
- âœ… æ‰‹åŠ¨ç§»åŠ¨æ—¶å–æ¶ˆæ‰€æœ‰äº¤äº’

### 9. ä¸–ç•Œé‡ç½®
- âœ… regenerateTreesæ¸…ç†oresæ•°ç»„

---

## ğŸš§ å¾…å®ŒæˆåŠŸèƒ½

### 1. çŸ¿çŸ³æ¸²æŸ“ (CRITICAL)
- âŒ drawOres()å‡½æ•°ï¼šæ¸²æŸ“çŸ¿çŸ³ç²¾çµ
- âŒ é€‰ä¸­çŸ¿çŸ³æ—¶æ˜¾ç¤ºæŒ‡ç¤ºç®­å¤´
- âŒ åœ¨ä¸»æ¸²æŸ“å¾ªç¯ä¸­è°ƒç”¨drawOres()

### 2. çŸ¿çŸ³æŒ–æ˜è¿›åº¦æ¡
- âŒ drawOreMineProgress()å‡½æ•°
- âŒ æ˜¾ç¤º6ç§’æŒ–æ˜è¿›åº¦ï¼ˆé’è‰²è¿›åº¦æ¡ï¼‰
- âŒ åœ¨ä¸»æ¸²æŸ“å¾ªç¯ä¸­è°ƒç”¨

### 3. çŸ¿çŸ³ç¢°æ’æ£€æµ‹
- âŒ collidesOre(x, y, rad)å‡½æ•°
- âŒ ç©å®¶ç§»åŠ¨æ—¶æ£€æµ‹çŸ¿çŸ³ç¢°æ’
- âŒ æ•Œäººç§»åŠ¨æ—¶æ£€æµ‹çŸ¿çŸ³ç¢°æ’
- âŒ æ”¾ç½®ç‰©å“æ—¶æ£€æµ‹çŸ¿çŸ³ç¢°æ’

### 4. çŸ¿çŸ³æ‰è½ç‰©æ¸²æŸ“
- âŒ drawDrops()ä¸­æ·»åŠ 7ç§çŸ¿çŸ³çš„æ¸²æŸ“
- âŒ æ¯ç§çŸ¿çŸ³ä½¿ç”¨å¯¹åº”é¢œè‰²çš„åœ†å½¢+æè¾¹

### 5. UIæ˜¾ç¤ºï¼ˆèƒŒåŒ…/ç®±å­/å·¥ä½œå°ï¼‰
- âŒ æ·»åŠ é•å­åˆ°åˆ—è¡¨æ˜¾ç¤º
- âŒ æ·»åŠ æ‰€æœ‰çŸ¿çŸ³åˆ°åˆ—è¡¨æ˜¾ç¤º
- âŒ è®¾è®¡é•å­å›¾æ ‡
- âŒ è®¾è®¡çŸ¿çŸ³å›¾æ ‡ï¼ˆå¸¦é¢œè‰²çš„å°æ–¹å—ï¼‰

---

## ğŸ“‹ å®ç°æ¸…å•

### éœ€è¦æ·»åŠ çš„å‡½æ•°

```javascript
// 1. çŸ¿çŸ³æ¸²æŸ“
function drawOres(){
  if(STYLE==='pixlake' && tiles.ready){
    for(const ore of ores){
      const cx = Math.round(ore.x - camera.x);
      const cy = Math.round(ore.y - camera.y);
      const s = 2.8;
      // é˜´å½±
      ctx.save(); 
      ctx.globalAlpha=0.28; 
      ctx.fillStyle='#000'; 
      ctx.beginPath(); 
      ctx.ellipse(cx, cy + Math.round(3*s), Math.round(6*s), Math.round(3*s), 0, 0, Math.PI*2); 
      ctx.fill(); 
      ctx.restore();
      // ç»˜åˆ¶çŸ¿çŸ³ç²¾çµ
      ctx.drawImage(tiles.ores[ore.type], cx - 8*s, cy - 8*s, 16*s, 16*s);
      // é€‰ä¸­æŒ‡ç¤º
      if(selectedOreId === ore.id){
        const ax = cx, ay = cy - 16;
        ctx.save();
        ctx.fillStyle='#06b6d4'; 
        ctx.strokeStyle='#0891b2'; 
        ctx.lineWidth=1.5;
        ctx.beginPath(); 
        ctx.moveTo(ax, ay); 
        ctx.lineTo(ax-7, ay-10); 
        ctx.lineTo(ax+7, ay-10); 
        ctx.closePath(); 
        ctx.fill(); 
        ctx.stroke(); 
        ctx.restore();
      }
    }
    return;
  }
  // fallback
  for(const ore of ores){
    const cx = Math.round(ore.x - camera.x);
    const cy = Math.round(ore.y - camera.y);
    // ä½¿ç”¨çŸ¿çŸ³é¢œè‰²
    const colors = {
      copper: '#d97706', tin: '#94a3b8', iron: '#78716c',
      silver: '#e5e7eb', gold: '#fbbf24', darkGold: '#a16207', diamond: '#06b6d4'
    };
    ctx.fillStyle = colors[ore.type] || '#6b6b73';
    ctx.beginPath(); 
    ctx.arc(cx, cy, 10, 0, Math.PI*2); 
    ctx.fill();
    ctx.strokeStyle = '#4a4a52'; 
    ctx.lineWidth = 2; 
    ctx.stroke();
    if(selectedOreId === ore.id){
      const ax = cx, ay = cy - 16;
      ctx.save();
      ctx.fillStyle='#06b6d4'; 
      ctx.strokeStyle='#0891b2'; 
      ctx.lineWidth=1.5;
      ctx.beginPath(); 
      ctx.moveTo(ax, ay); 
      ctx.lineTo(ax-7, ay-10); 
      ctx.lineTo(ax+7, ay-10); 
      ctx.closePath(); 
      ctx.fill(); 
      ctx.stroke(); 
      ctx.restore();
    }
  }
}

// 2. çŸ¿çŸ³æŒ–æ˜è¿›åº¦æ¡
function drawOreMineProgress(){
  if(!oreMine.active || oreMine.total<=0) return;
  const ore = ores.find(o=>o.id===oreMine.oreId);
  if(!ore) return;
  const pct = Math.max(0, Math.min(1, (oreMine.total - oreMine.time)/oreMine.total));
  const cx = Math.round(ore.x - camera.x);
  const cy = Math.round(ore.y - camera.y);
  const w = 30, h = 6, x = cx - (w>>1), y = cy + 12;
  ctx.fillStyle = 'rgba(0,0,0,0.5)'; 
  ctx.fillRect(x-1, y-1, w+2, h+2);
  ctx.fillStyle = '#222'; 
  ctx.fillRect(x, y, w, h);
  ctx.fillStyle = '#06b6d4'; // é’è‰²è¿›åº¦
  ctx.fillRect(x, y, Math.floor(w*pct), h);
}

// 3. çŸ¿çŸ³ç¢°æ’æ£€æµ‹
function collidesOre(x,y,rad){
  const r = (rad||8) + 8;
  const r2 = r*r;
  for(const ore of ores){ 
    const dx=ore.x-x, dy=ore.y-y; 
    if(dx*dx+dy*dy <= r2) return true; 
  }
  return false;
}
```

### éœ€è¦æ·»åŠ çš„æ¸²æŸ“è°ƒç”¨

åœ¨ä¸»æ¸²æŸ“å¾ªç¯ä¸­ï¼ˆçº¦3160è¡Œé™„è¿‘ï¼‰ï¼š
```javascript
drawTrees();
drawRocks();
drawOres();        // â† æ·»åŠ è¿™é‡Œ
drawChopProgress();
drawMineProgress();
drawOreMineProgress();  // â† æ·»åŠ è¿™é‡Œ
drawPlayer();
```

### éœ€è¦æ›´æ–°çš„ç¢°æ’æ£€æµ‹

```javascript
// ç©å®¶ç§»åŠ¨ (çº¦2482è¡Œ)
if(!isWater(nx, player.y) && !collidesTree(nx, player.y, 10) && !collidesRock(nx, player.y, 10) && !collidesOre(nx, player.y, 10) && !collidesWall(nx, player.y, 6)) player.x = nx;
if(!isWater(player.x, ny) && !collidesTree(player.x, ny, 10) && !collidesRock(player.x, ny, 10) && !collidesOre(player.x, ny, 10) && !collidesWall(player.x, ny, 6)) player.y = ny;

// æ•Œäººç§»åŠ¨ (çº¦2718è¡Œ)
if(!isWater(ex, e.y) && !collidesTree(ex, e.y, e.r) && !collidesRock(ex, e.y, e.r) && !collidesOre(ex, e.y, e.r) && !blockedX) e.x = ex;
if(!isWater(e.x, ey) && !collidesTree(e.x, ey, e.r) && !collidesRock(e.x, ey, e.r) && !collidesOre(e.x, ey, e.r) && !blockedY) e.y = ey;

// æ”¾ç½®ç‰©å“ (çº¦674è¡Œ, 1936è¡Œ, 1945è¡Œ, 1953è¡Œ)
const valid = !tooClosePlayer && !isWaterArea(sx, sy, cell*0.4) && !collidesTree(sx, sy, 10) && !collidesRock(sx, sy, 10) && !collidesOre(sx, sy, 10) && !collidesWall(sx, sy, Math.max(1, cell/2 - 2));
```

---

## ğŸ® ä½¿ç”¨æŒ‡å—

### å¦‚ä½•æŒ–æ˜çŸ¿çŸ³
1. åœ¨å·¥ä½œå°ç”¨3çŸ³å—+2æœ¨æ£åˆ¶ä½œé•å­
2. è£…å¤‡é•å­ï¼ˆå°†é•å­ç§»åŠ¨åˆ°è£…å¤‡æ ï¼‰
3. æ¢ç´¢ä¸–ç•Œå¯»æ‰¾å¸¦å½©è‰²ç‚¹çš„ç¢çŸ³
4. ç‚¹å‡»çŸ¿çŸ³å¼€å§‹æŒ–æ˜ï¼ˆ6ç§’ï¼‰
5. è·å¾—å¯¹åº”çš„çŸ¿çŸ³

### çŸ¿çŸ³ç¨€æœ‰åº¦
- **å¸¸è§**ï¼šé“œçŸ¿ã€é”¡çŸ¿ï¼ˆå®¹æ˜“æ‰¾åˆ°ï¼‰
- **ä¸å¸¸è§**ï¼šé“çŸ¿ï¼ˆéœ€è¦ä¸€äº›è¿æ°”ï¼‰
- **ç¨€æœ‰**ï¼šé“¶çŸ¿ã€é‡‘çŸ¿ï¼ˆè¾ƒéš¾æ‰¾åˆ°ï¼‰
- **éå¸¸ç¨€æœ‰**ï¼šé»‘é‡‘çŸ¿ï¼ˆå¾ˆéš¾æ‰¾åˆ°ï¼‰
- **ä¼ è¯´**ï¼šé’»çŸ³ï¼ˆæå…¶ç¨€æœ‰ï¼Œ1%æ¦‚ç‡ï¼‰

---

## ğŸ”§ å¿«é€Ÿä¿®å¤æ­¥éª¤

è¦å®Œæˆå‰©ä½™åŠŸèƒ½ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºï¼š

1. **æ·»åŠ drawOreså‡½æ•°** - å¤åˆ¶drawRocksæ ·å¼
2. **æ·»åŠ drawOreMineProgresså‡½æ•°** - å¤åˆ¶drawMineProgressæ ·å¼
3. **æ·»åŠ collidesOreå‡½æ•°** - å¤åˆ¶collidesRockæ ·å¼
4. **æ›´æ–°ä¸»æ¸²æŸ“å¾ªç¯** - æ·»åŠ drawOres()å’ŒdrawOreMineProgress()è°ƒç”¨
5. **æ›´æ–°æ‰€æœ‰ç¢°æ’æ£€æµ‹** - æ·»åŠ collidesOreæ£€æŸ¥

å®ŒæˆåçŸ¿çŸ³ç³»ç»Ÿå°†å®Œå…¨å¯ç”¨ï¼ğŸ‰
